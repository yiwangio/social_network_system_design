# social_network_system_design
Домашнее задание по курсу System Design
System Design социальной сети для курса по System Design(https://balun.courses/courses/system_design)

## Описание
- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников;

> Что касается будущей аудитории социальной сети - у бизнеса есть огромные средства для рекламы и продвижения социальной сети, поэтому пользовательская база будет постепенно линейно расти и через год достигнет примерно 10 000 000 уникальных пользователей в день, после чего также будет продолжать расти. Бизнес пока нацелен только на аудиторию стран СНГ (*на зарубежный рынок выходить планов нет*). Будущая система должна быть очень надежной, а также, чтобы с ней было удобно взаимодействовать, используя мобильные устройства и браузер.


## Функциональные требования
- возможность пользователя создать пост, состоящий из текста, медиa, и локации
  - возможность изменять пост, удалять
- Поиск пользователя/места
- возможность поставить/убрать оценку (лайк/огонь/смех/дизлайк)
- добавления комментария к посту. Состоит только из текста
- механизм подписки/отписки от других пользователей
- лента пользователя. Состоит из постов других пользователей, на которых оформлена подписка
- аккаунт пользователя. Представляет из себя ленту постов только этого пользователя
- место. Состоит из рейтинга, популярности и фотографий пользователей, которые поставили локацию этого места на своих фотографиях
- Мобильное приложение и web версия
- Сжатие фотографий для экономии места

## Нефункциональное требования
- DAU 10 000 000
- Поведение пользователя
  - 3 раза в день ежедневно
  - среднее время на сервисе 40 минут
  - 2 поисковых запроса в день
  - в день просмотрел 60 постов
    - комменты смотрит у 15
    - 10 комментариев в месяц пишет сам
    - 30 оценок в день ставит
  - в среднем 2 поста в месяц выкладывает пользователь
- сезонность - лето/новый год/майские
- SLA 99.95
- храним все данные всегда
- страны СНГ
- Тайминги
  - загрузка собственного поста <= 2 сек
  - загрузка обновлений ленты <= 1 сек
    - загрузка медиа <= 2 сек
  - загрузка комментариев <= 1 сек
  - Поиск пользователя/места <= 2 сек

## Нагрузка    
### Поиск 
RPS = 10 000 000 * 2 / 86400 = 231
traffic = 231 * 100б * 10 постов = 231 КБ/sec


### Посты
_**Таблица**_
- id 4б
- user id 4б
- desc 1600 б
- location 128b
- media (макс. 800 КБ)

Общие
RPS(read) = 10 000 000 * 60 / 86400 = 7000 
RPS(write) = 10 000 000 / 15 / 86400 = 8

**media**
просмотр
**Traffic**(read) =  11.2 GB / sec
загрузка
**Traffic** (write) = 8 * 1600 = 12.3 MB / sec

**capacity** = 12.33 * 86400 * 365  = 387.9 TB (400)

**описание поста**
просмотр
**Traffic**(read) =  12 MB / sec
загрузка
**Traffic**(write) = 8 * 1650b = 12.7 Kb/sec  
**capacity** = 12.7 * 86400 * 365  = 0.3 TB (500 GB)

### Комменты
_**Таблица**_
- id 4б
- user id 4б
- post id 4б
- desc 1600 б

получение  
**RPS**(read) = 10 000 000 * 15 / 86400 = 1750 
**Traffic**(read) =  1750 * 1.6 = 2.8 MB / sec

**RPS** (write) = 10 000 000 / 3 / 86400 = 385
**Traffic** = 385 * 1.6 = 0.6 MB / sec

**capacity** = 0.6 * 86400 * 365 = 20 TB

### Реакции
_**Таблица**_
- id 4б
- user_id 4б
- post_id 4б
- reactions 1б

**RPS**(write) = 10 000 000 * 30 / 86400 = 3472
**Traffic**(write) = 3472 * 13б = 45 КБ / сек

**RPS** (READ) = 10 000 000 * 10 / 86400 = 1150 (просмотр полного списка реакций)
**traffic** = 7000 * 13б = 15 КБ / сек

**capacity** = 45 КБ * 86400 * 365 = 1.5 TB

### Итог  
Описание постов + комменты + реакции ~ 22 TB  
**RPS**(READ) = 7000 + 1750 + 1150 ~ 10 000 / sec  
**RPS**(WRITE) = 8 + 385 + 3472 ~ 4000 / sec  

**iops**
reading = 10 000 / 1000 ~ 10 ssd  
writing = 4000 / 1000 ~ 4 ssd  

**traffic**  
read ~ 15 Mb / sec  
write ~ 0.7 Mb / sec  

**Реплики**  
master  
4x6TB SSD 4000IOPS

Slave 1  
3x8TB SSD 3000IOPS

Slave 2   
3x8TB SSD 3000IOPS


**Media**  
capacity = 387.9 TB (400)  
Disks_for_throughput (read) = 11200 / 500 = 23   
IOPS (write) = 7.7 / 1000 = too low  
IOPS (read) = 7000 / 1000 = 7 (SSD)  

25x16TB 25k IOPS; 12.5 GB/sec 
